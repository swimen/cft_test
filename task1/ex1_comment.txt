Задание 1
---------
В дереве разделов с любым количеством уровней
каждый раздел на любом уровне может иметь перечень тем...

-- у каждого раздела могут быть как подразделы, так и темы
create table chapters (chapid number primary key, -- идентификатор раздела
 par_chapid number references chapters, -- ссылка на родительский раздел
 subject varchar2(200), -- имя таблицы тем данного раздела
 wpages varchar2(4000), -- таблицы страниц для таблицы раздела через запятую (пример: 'wpage1,wpage2')
 address varchar2(400) -- адрес расположения
 );
create index chapind_id on chapters (chapid,subject) compute statistics;

-- формат таблиц тем (здесь к примеру subject1)
create table subject1 (subjectid number primary key,--  ключ
 numberofviews number(10), -- количество просмотров
    name varchar2(200) -- наименование
);
create index subject1ind_id on subject1 (subjectid) compute statistics;

-- у темы есть страницы
-- для каждой страницы создана отдельная таблица
-- для примера wpage1
create table wpage1 (subject references subject1, -- ссылка на тему
header varchar2(1000), -- заголовок сообщения
answers number -- количество ответов 
);

Задача:
Вывести в виде дерева список разделов упорядоченно по адресу расположения (по возрастанию).
У каждого раздела вывести ВСЕ его темы.
Не имеющие страниц темы не выводить, но пустые разделы вывести.
В каждой теме вывести ВСЕ страницы
Для каждой страницы вывести первые 5 заголовков из всех в порядке УБЫВАНИЯ значения в поле ANSWERS.

Во время выполнения кода изменений данных не происходит.
Код должен быть как можно более отказоустойчивым.

Пример формата вывода
 Раздел Кх
  ...
  Тема m
   ...
   Страница1
    1 header, answers
    ...
    5 header, answers
  ...
  Подраздел Кх.n
   ...
   Тема i
    ...
    Page
     1 header, answers
     ...
     5 header, answers

Структуру данных изменять нельзя! При необходимости можно добавлять индексы.

РЕШЕНИЕ:
======================================================================================
Создаем индекс на  по полю  address в таблице chapters - пригодится для сортировки

Можно еще добавить индекс по кол-ву ответов в таблицах страниц, 
но для реальной задачи надо выбирать между производительностью данного отчета и 
затратами на перестроение индекса при частых изменениях поля

Разделы выбираем иерархическим запросом.
С темами и страницами работаем через Ref курсор.

В случае отсутствия таблиц или других ошибок, пишем их в pl/sql таблицу, и выводим после 
основного отчета

Для выбора первых пяти заголовков тем по кол-ву ответов используем аналитическую функцию.

Заголовки сначала грузим в pl/sql таблицу, потом в цикле выводим.
Немного экономим на переключении контекста. 
В других местах это не очень удобно по структуре кода.


